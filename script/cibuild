#!/bin/bash
set -euo pipefail
IFS=$'\n\t'

cd "$(dirname "$0")/.."

# script/cibuild: Run the test suite from CI.

# Allow called scripts to detect that its being run by CI
export CI_BUILD=true

echo -e '\n== Running cibuild =='
export RAILS_ENV=test
export RAKE_ENV=test

script/bootstrap

bin/rake db:create db:migrate

export DOC_EXAMPLES=false
export LINT_FACTORY=true
export RUBOCOP=false
export CHECK_DB_INDEXES=true
export CHECK_DB_UNIQ_INDEXES=true
script/test --tag ~no_travis --tag ~regressor spec
